
.row
  .col-sm-6
    .panel.panel-default#user_info
      / Everybody can see this
      .panel-heading
        %h2.panel-title=t(:user_information)
      .panel-body
        .form-horizontal
          .form-group
            %label.col-sm-3.control-label= t(:first_name)
            .col-sm-9
              %p.form-control-static= user.first_name
          .form-group
            %label.col-sm-3.control-label= t(:last_name)
            .col-sm-9
              %p.form-control-static= user.last_name
          .form-group
            %label.col-sm-3.control-label= t(:email)
            .col-sm-9
              %p.form-control-static= user.email
          -if user.phone
            .form-group
              %label.col-sm-3.control-label= t(:phone)
              .col-sm-9
                %p.form-control-static= user.phone
          -if user.title
            .form-group
              %label.col-sm-3.control-label= t(:title)
              .col-sm-9
                %p.form-control-static= user.title
          .form-group
            %label.col-sm-3.control-label= t(:preferred_locale)
            .col-sm-9
              %p.form-control-static= I18n.t("locales.#{user.preferred_locale}")
          - if user.walking_speed_id
            - user_walk_speed = WalkingSpeed.where(id:user.walking_speed_id).first
            - if user_walk_speed
              .form-group
                %label.col-sm-3.control-label= t(:walking_speed)
                .col-sm-9
                  %p.form-control-static= user_walk_speed.label
          - if user.walking_maximum_distance_id
            - user_walk_max_dist = WalkingMaximumDistance.where(id:user.walking_maximum_distance_id).first
            - if user_walk_max_dist
              .form-group
                %label.col-sm-3.control-label= t(:walking_maximum_distance)
                .col-sm-9
                  %p.form-control-static= user_walk_max_dist.label
  - if can? :full_read, user
    .col-sm-6
      .panel.panel-default#agencies
        .panel-heading
          %h2.panel-title=t(:agencies)
        .panel-body
          = render partial: 'users/agency_table', locals: { user: user }

- if current_user.has_role?(:agent) or current_user.has_role?(:agency_administrator)
  .row
    .col-sm-12
      .panel.panel-default
        .panel-heading
          %h2.panel-title=t(:traveler_notes)
        .panel-body
          -TravelerNote.where(user: @user, agency: current_user.agency).each do |note|
            =note.note

- if can? :full_read, user
  .row
    .col-sm-12
      .panel.panel-default#buddies
        .panel-heading
          %h2.panel-title= t(:buddies)
        .panel-body
          %table.table.table.condensed.table-striped.table-hover.table-bordered.table-responsive#buddies_table
            %thead
              %th= t(:buddy)
              %th.email= t(:email)
              %th= t(:can_assist_me)
              %th= t(:i_can_assist)
            %tbody
              -# initial load from user record
              - @user.related_users.each do |ou|
                %tr
                  - urp = UserRelationshipProxy.new(@user, ou)
                  %td= urp.you.name
                  %td.email= urp.you.email
                  %td= UserRelationshipDecorator.decorate(urp.can_assist_me).status
                  %td= UserRelationshipDecorator.decorate(urp.i_can_assist).assist_btn
  .row
    .col-sm-6
      .panel.panel-default#eligibility
        .panel-heading
          %h2.panel-title= t(:eligibility)
        .panel-body
          = render :partial =>'users/show_characteristics_answers', :locals => { :user_characteristics => @user_characteristics_proxy, collection: Characteristic.active.enabled }
    .col-sm-6
      .panel.panel-default#accommodations
        .panel-heading
          %h2.panel-title= t(:accommodations)
        .panel-body
          = render :partial =>'users/show_characteristics_answers', :locals => { :user_characteristics => @user_accommodations_proxy, collection: Accommodation.where(:datatype => 'bool') }
  .row
    .col-sm-6
      .panel.panel-default#booking
        .panel-heading
          %h2.panel-title=t(:booking_information)
        .panel-body
          = render :partial => 'users/show_booking_info', locals: { user: user }
    .col-sm-6
      .panel.panel-default#preferred_modes
        .panel-heading
          %h2.panel-title= t(:preferred_modes)
        .panel-body
          - Mode.top_level.where(visible: true).sort{|a, b| I18n.t(a.name) <=> I18n.t(b.name)}.each do |m|
            .row
              .col-sm-12
                = check_box_tag "user[preferred_mode_ids][#{m.id}]", m.id, @user.preferred_modes.include?(m), name: "user[preferred_mode_ids][]", disabled: true
                = label_tag "user[preferred_mode_ids][#{m.id}]", t(m.name)
                - m.submodes.where(visible: true).each do |sm|
                  .row
                    .col-sm-12.col-sm-push-1
                      = check_box_tag "user[preferred_mode_ids][#{sm.id}]", sm.id, @user.preferred_modes.include?(sm), name: "user[preferred_mode_ids][]", disabled: true
                      = label_tag "user[preferred_mode_ids][#{sm.id}]", t(sm.name)

:javascript
  $(document).ready(function() {
    $('#buddies_table').dataTable( {
          "oLanguage": {
            "sLengthMenu": "Display _MENU_ buddies per page",
            "sZeroRecords": "Nothing found - sorry",
            "sInfo": "Showing _START_ to _END_ of _TOTAL_ buddies",
            "sInfoEmpty": "Showing 0 to 0 of 0 buddies",
            "sInfoFiltered": "(filtered from _MAX_ total buddies)"
          },
          "sDom": "<'row'<'col-sm-6'f>><'row'<'col-sm-6'l>r>t<'row'<'col-sm-6'i><'col-sm-6'p>>",
      } );
    });