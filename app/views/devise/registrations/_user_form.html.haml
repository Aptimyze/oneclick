=simple_form_for @user, :url => registration_path(User), :html => { :class => "form-horizontal"}, method: 'post', wrapper: :horizontal_form, wrapper_mappings: { check_boxes: :horizontal_radio_and_checkboxes, radio_buttons: :horizontal_radio_and_checkboxes, file: :horizontal_file_input, boolean: :horizontal_boolean }, :include_blank => false  do |f|
  .row
    = link_to t(:cancel), :back, class: "pull-right"
    = f.button :submit, t(:save), class: "action-button pull-right"
    %h1
      %i{class: "icon #{CsHelpers::ACTION_ICONS[:travel_profile]}"}
      = current_user != @user ? "#{@user.name}'s #{t(:travel_profile)}" : t(:travel_profile)
  .row
    .col-sm-6
      .well#user_info
        %h2= t(:user_information)
        = f.input :first_name, label: t(:first_name), :autofocus => true, :required => true
        = f.input :last_name, label: t(:last_name), :required => true
        = f.input :email, label: t(:email), :required => true
        = f.input :preferred_locale, label: t(:preferred_locale), :collection => Translation.available_locales, :include_blank => false
        = f.input :password, label: t(:password), :autocomplete => "off", :required => false
        = f.input :password_confirmation, label: t(:password_confirmation), :hint => t(:leave_password_blank), :required => false
    .col-sm-6
      .well#agencies
        %h2= t(:agencies)
        = f.association :approved_agencies, collection: Agency.all, input_html: {size: 10}, value_method: :agency_id, label: false
  .row
    .col-sm-6.pull-left
      .well#buddies
        %h2= t(:buddies)
        = f.association :buddies, collection: User.registered, label: false, input_html: {size: 6}
    .col-sm-6.pull-right
      .well#travelers
        %h2= t(:travelers)
        = render partial: 'traveler_table', locals: {user: @user}
  .row
    .well
      =simple_fields_for :user_characteristics_proxy, html: {class: 'form-horizontal'}, wrapper: :h_opts_form, wrapper_mappings: {check_boxes: :h_opts_radio_and_checkboxes, radio_buttons: :h_opts_radio_and_checkboxes, file: :h_opts_file_input, boolean: :h_opts_boolean }  do |characteristic_form|
        -Characteristic.active.enabled.each do |c| 
          - next if c.code=='age' # TODO kludge
          - case c.datatype
          - when 'bool'
            = characteristic_form.input c.code.to_sym, collection: [[true, t(:yes_str)], [false, t(:no_str)], ['na', t(:not_sure_str)]], :required => false, as: :radio_buttons, label: t(c.note), label_method: :last, value_method: :first
          - else
            = characteristic_form.input c.code.to_sym, label: t(c.note)
        -Accommodation.where(:datatype => 'bool').each do |a|
          = characteristic_form.input a.code.to_sym, collection: [[true, t(:yes_str)], [false, t(:no_str)], ['na', t(:not_sure_str)]], :required => false, as: :radio_buttons, label: t(a.note), label_method: :last, value_method: :first