.modal.fade{id: "feedback_modal"}
  .modal-dialog.modal-lg
    .modal-content
      -# If the public can read feedback...
      - if can? :read, rateable.ratings.build
        .panel.panel-default
          .panel-heading
            %h3
              = rateable.name
              - if can? :create, rateable.ratings.build(rateable: rateable)
                %button.btn.action-button.btn-default.pull-right#load_feedback
                  = t(:feedback)
          .panel-body
            -unless rateable.ratings.approved.empty?
              %dl.dl-horizontal
                - rateable.ratings.approved.decorate.each do |r|
                  %dt.rating-value= r.rating_in_stars
                  %dd.rating-comments= r.comments 
            -else
              .alert
                =t(:no_ratings_yet)
        .modal-footer
          %btn.btn.btn-default.action-button{data: {dismiss: "modal"}}= t(:close)
      
-# Load in the form dynamically
- if can? :create, rateable.ratings.build(rateable: rateable)
  :javascript
    $(document).ready(function() {
      $("#load_feedback").on("click", function() {
        $.ajax({
          url: "#{RateableDecorator.new(rateable).new_rateable_rating_path}",
          context: $(".modal-content"),
          dataType: "html"
        })
        .then( function(html) {
          $(this).html(html)
        });
      });
    });