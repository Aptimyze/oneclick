%h1
  = link_to(@agency.name, [:admin, @agency]) |
  Users

%table.table.table-condensed.table-striped.table-bordered.table-hover#datatable#admin_users_table
  %thead
    %tr
      %th Username
      %th Email
      %th Registered
      %th Role
      %th
  %tbody
    - @users.each do |user|
      %tr
        %td= link_to user.name, [:admin, user]
        %td= user.email
        %td= user.created_at.to_date
        %td= user.roles.first.name.titleize unless user.roles.first.nil?
        %td.center
          %a.btn{"data-toggle" => "modal", :href => "#role-options-#{user.id}", :type => "button"} Change role
          = render partial: user, locals: {agency: @agency}

= link_to 'Add User', '#select_user', {class: 'btn', "data-toggle" => "modal"}

.modal.hide.fade#select_user
  .modal-header
    %a.close{"data-dismiss" => "modal"} Ã—
    %h3 Select users
    = simple_form_for @agency, url: add_to_agency_admin_agency_users_path(@agency), html: { class: 'form-horizontal'},
      data: {dismiss: 'modal'}  do |f|
      = f.error_notification
      = f.association :users, collection: @agency.unselected_users, as: :check_boxes, label_method: :email_and_agency, value_method: :id
      .modal-footer
        = button_tag type: :submit, class: 'btn btn-info' do
          %i.icon-plus
          Add
        %a{'data-dismiss' => 'modal'}
          %i.icon.icon-reply
          = t(:cancel)

:javascript
  $(document).ready(function() {
    $('#admin_agencies_table').dataTable( {
          "oLanguage": {
              "sLengthMenu": "Display _MENU_ agencies per page",
              "sZeroRecords": "Nothing found - sorry",
              "sInfo": "Showing _START_ to _END_ of _TOTAL_ agencies",
              "sInfoEmpty": "Showing 0 to 0 of 0 agencies",
              "sInfoFiltered": "(filtered from _MAX_ total agencies)"
          }
      } );
  } );
