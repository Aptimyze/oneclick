= form_tag approve_admin_sidewalk_obstructions_path, method: :patch do
  .row.info-header
    .col-sm-12
      .btns.pull-right
        = submit_tag t(:apply), class: "btn action-button"
        = link_to t(:cancel), admin_sidewalk_obstructions_path, class: "btn action-button"
      %h1= t(:sidewalk_obstructions)
    #deleteSidewalkObstructionConfirmDialog.modal.fade.col-sm-12{"aria-describedby" => t(:remove_sidewalk_obstructions), :role => "dialog", "aria-hidden" => 'true', :tabindex => "-1"}
      .modal-dialog
        .modal-content
          .modal-header
            = button_tag class: 'btn action-button pull-right', action: 'cancel_delete', data: {dismiss: 'modal'} do
              = t(:cancel)
            = button_tag class: 'btn action-button pull-right', action: 'confirm_delete', data: {dismiss: 'modal'} do
              = t(:ok)
            .modal-title{:style => "text-align:left;"}
              %b
                = t(:site_title)
          .modal-body{:style => "text-align:left;"}
            = t(:confirm_remove_message) + t(:sidewalk_obstructions).downcase + " ?"
  .panel.panel-default{style: 'padding: 0px;'}
    .panel-heading
      %h2.panel-title
        = t(:sidewalk_obstructions)
        = add_tooltip("sidewalk_obstructions_help")
    .panel-body
      %table.table.table-condensed.table-striped.table-bordered.table-hover#sidewalk_feedbacks_table
        %thead
          %tr
            %th= t(:username)
            %th= t(:comments)
            %th= t(:remove_by)
            %th= t(:approve)
            %th= t(:reject)
            %th= t(:delete)
            %th= t(:created)
            %th
        %tbody
          - @sidewalk_obstructions.each do |feedback|
            %tr
              %td= feedback.user.name
              %td= feedback.comment
              %td.nowrap
                - unless feedback.removed_at.nil?
                  =format_date_time(feedback.removed_at)
              %td
                = label_tag "#{feedback.id}_#{SidewalkObstruction::APPROVED}", t(:approve), class: "sr-only"
                = radio_button_tag "#{feedback.id}", SidewalkObstruction::APPROVED, feedback.approved?

              %td
                = label_tag "#{feedback.id}_#{SidewalkObstruction::REJECTED}", t(:reject), class: "sr-only"
                = radio_button_tag "#{feedback.id}", SidewalkObstruction::REJECTED, feedback.rejected?
              %td
                = label_tag "#{feedback.id}_#{SidewalkObstruction::DELETED}", t(:delete), class: "sr-only"
                = radio_button_tag "#{feedback.id}", SidewalkObstruction::DELETED
              %td.nowrap= format_date_time(feedback.created_at)
              %td.center
                - if feedback.lat and feedback.lon
                  = link_to Rails.application.config.street_view_url + '?lat=' + feedback.lat.to_s + '&lng=' + feedback.lon.to_s, class: 'btn action-button', target: '_blank', role: 'button' do
                    = t(:street_view)

:javascript
$(document).ready( function() {
  var submitChanges = function() {
    $.ajax({
      type: "POST",
      url: "/admin/sidewalk_obstructions/approve",
      data: {
        "utf8":"âœ“",
        "_method":"patch",
        "authenticity_token": $("input[name=authenticity_token]").val(),
        "approve": $("input:checked", table.fnGetNodes()).serialize()
      },
      // This can't just be a reload or we hit issues with the reload
      success: function() {
        window.location = window.location
      }
    });
  };
  $("form").submit(function( event ) {
    event.preventDefault();
    if($("input:checked[value=deleted]").length > 0) {
      $('#deleteSidewalkObstructionConfirmDialog').modal('show');
    } else {
      submitChanges();
    }
  });

  $('#deleteSidewalkObstructionConfirmDialog button[action=confirm_delete]').on('click', function(){
    submitChanges();
  });

  $('#deleteSidewalkObstructionConfirmDialog button[action=cancel_delete]').on('click', function(){
    $("input:checked[value=deleted]").each(function(){$(this).removeAttr('checked');})
    submitChanges();
  });

  var table = $('#sidewalk_feedbacks_table').dataTable( {
    "aaSorting": [[ 6, "desc" ]],
    "aoColumnDefs": [
      { "bSortable": false, "aTargets": [ 3,4,5 ] },
      { "bSearchable": false, "aTargets": [ 3,4,5 ] }
    ],
    "oLanguage": {
              "sLengthMenu": "Display _MENU_ items per page",
              "sZeroRecords": "Nothing found - sorry",
              "sInfo": "Showing _START_ to _END_ of _TOTAL_ items",
              "sInfoEmpty": "Showing 0 to 0 of 0 items",
              "sInfoFiltered": "(filtered from _MAX_ total items)"
    },
    "bAutoWidth": false,
    "aoColumnDefs": [
      { "sWidth": "10%", "aTargets": [ 0 ] },
      { "sWidth": "40%", "aTargets": [ 1 ] },
      { "sWidth": "5%", "aTargets": [ 3, 4, 5 ] }
    ],
    "sDom": "<'row'<'col-sm-6'f>><'row'<'col-sm-6'l>r>t<'row'<'col-sm-6'i><'col-sm-6'p>>",
  } );
});
